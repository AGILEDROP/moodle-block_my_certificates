{"version":3,"file":"pdf_preview.min.js","sources":["../src/pdf_preview.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\ndefine('block_my_certificates/pdf_preview', [], function() {\n  'use strict';\n\n  /**\n   * Render a PDF on canvas.\n   * @param {HTMLCanvasElement} canvas The canvas element\n   * @param {string} workerSrc The worker source URL\n   */\n  async function renderCanvas(canvas, workerSrc) {\n      const url = canvas.dataset.src;\n      const pageN = 1;\n      const targetWidth = 900;\n\n      window.pdfjsLib.GlobalWorkerOptions.workerSrc = workerSrc;\n\n      const pdf = await window.pdfjsLib.getDocument(url).promise;\n      const page = await pdf.getPage(pageN);\n      const baseViewport = page.getViewport({scale: 1});\n      const scale = targetWidth / baseViewport.width;\n      const viewport = page.getViewport({scale});\n\n      canvas.width = viewport.width;\n      canvas.height = viewport.height;\n\n      const ctx = canvas.getContext('2d');\n\n      await page.render({\n          canvasContext: ctx,\n          viewport: viewport\n      }).promise;\n  }\n\n  /**\n   * Initialize PDF rendering for all .pdf-canvas elements.\n   * @param {Object} args Arguments with workersrc property\n   */\n  async function init(args) {\n      const workerSrc = args.workersrc;\n      const nodes = document.querySelectorAll('.pdf-canvas');\n      for (const node of nodes) {\n          await renderCanvas(node, workerSrc);\n      }\n  }\n\n  return {init: init};\n});"],"names":["define","renderCanvas","canvas","workerSrc","url","dataset","src","window","pdfjsLib","GlobalWorkerOptions","pdf","getDocument","promise","page","getPage","scale","getViewport","width","viewport","height","ctx","getContext","render","canvasContext","init","args","workersrc","nodes","document","querySelectorAll","node"],"mappings":"AAeAA,2CAA4C,IAAI,0BAQ/BC,aAAaC,OAAQC,iBAC1BC,IAAMF,OAAOG,QAAQC,IAI3BC,OAAOC,SAASC,oBAAoBN,UAAYA,gBAE1CO,UAAYH,OAAOC,SAASG,YAAYP,KAAKQ,QAC7CC,WAAaH,IAAII,QANT,GAQRC,MAPc,IAMCF,KAAKG,YAAY,CAACD,MAAO,IACLE,MACnCC,SAAWL,KAAKG,YAAY,CAACD,MAAAA,QAEnCb,OAAOe,MAAQC,SAASD,MACxBf,OAAOiB,OAASD,SAASC,aAEnBC,IAAMlB,OAAOmB,WAAW,YAExBR,KAAKS,OAAO,CACdC,cAAeH,IACfF,SAAUA,WACXN,cAeA,CAACY,oBARYC,YACVtB,UAAYsB,KAAKC,UACjBC,MAAQC,SAASC,iBAAiB,mBACnC,MAAMC,QAAQH,YACT1B,aAAa6B,KAAM3B"}